# Не светим версию nginx
server_tokens off;

# Реальные IP (если ты не за cloudflare/nginx перед nginx — можно оставить как есть)
# real_ip_header X-Forwarded-For;
# set_real_ip_from 172.16.0.0/12;
# real_ip_recursive on;

# Лимиты запросов (zone'ы)
limit_req_zone $binary_remote_addr zone=req_per_ip:10m rate=10r/s;
limit_conn_zone $binary_remote_addr zone=conn_per_ip:10m;

# Простая карта “плохих” user-agent’ов (часть мусора отсеет)
map $http_user_agent $bad_ua {
    default 0;
    ~*"(acunetix|sqlmap|nikto|nmap|masscan|zgrab|gobuster|dirbuster|wfuzz|hydra|curl|python-requests|aiohttp|httpclient|Go-http-client|libwww-perl)" 1;
}

# Логи — можно оставить дефолт, но добавим более полезный формат (опционально)
log_format main_ext '$remote_addr - $remote_user [$time_local] '
                    '"$request" $status $body_bytes_sent '
                    '"$http_referer" "$http_user_agent" '
                    'rt=$request_time ua="$upstream_addr" us="$upstream_status" urt="$upstream_response_time"';

access_log /var/log/nginx/access.log main_ext;