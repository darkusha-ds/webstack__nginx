# Базовые security headers (для HTTPS)
add_header X-Content-Type-Options "nosniff" always;
add_header X-Frame-Options "SAMEORIGIN" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;
add_header Permissions-Policy "geolocation=(), microphone=(), camera=()" always;

# HSTS (включай только если уверен, что HTTPS всегда будет работать)
add_header Strict-Transport-Security "max-age=15552000; includeSubDomains; preload" always;

# Ограничения на соединения/запросы (мягкие, чтобы не убить трафик)
limit_conn conn_per_ip 40;
limit_req zone=req_per_ip burst=40 nodelay;

# Режем совсем “плохие” user-agent’ы
if ($bad_ua) { return 444; }

# Не отдаём скрытые файлы/секреты
location ~* ^/(\.env|\.git|\.hg|\.svn|\.DS_Store|\.well-known/../) { return 444; }
location ~* ^/(docker-compose\.yml|compose\.yml|id_rsa|\.ssh|\.bash_history) { return 444; }

# Популярные скан-ручки
location ~* ^/(wp-admin|wp-login\.php|xmlrpc\.php|wp-content|wp-includes)/ { return 444; }
location ~* ^/(phpmyadmin|pma|adminer|mysql|db|database)\b { return 444; }
location ~* ^/(swagger|swagger-ui|api-docs|v2/api-docs|v3/api-docs)\b { return 444; }

# Явно запрещаем “server-status”
location = /server-status { return 404; }